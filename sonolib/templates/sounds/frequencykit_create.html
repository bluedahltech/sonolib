{% extends "base.html" %}
{% block content %}
<form class="form-horizontal" method="post" action="{% url 'sounds:create_frequencykit' %}">
  {% csrf_token %}
  <div style="margin-top: 24px;">

    <h2>
      Create Single-Sound Kit
    </h2>

    <div class="row" style="margin-top: 12px;">
      <div class="col">
        <input id="title" class="form-control" type="text" name="title" value="" placeholder="Title" />
      </div>
    </div>

    <div class="row" style="margin-top: 24px;">
      <div class="col">
        <h5>
          Map Frequencies to Keys
        </h5>
        
        <a href="https://github.com/darrendahl/sono.ly/blob/master/frequency-chart.png" target="_blank">See frequency chart</a>
        {% for key_code in key_codes %}
          <div class="row form-group" style="margin: 24px 0;">
            <div class="col">
              {{key_code.title}}
              {{key_code.code}}
            </div>
            <div class="col">
              <input type="number" name="keycode_{{key_code.id}}" id="{{key_code.id}}" step="any" /> 
            </div>

            <div class="col">
              Standard pitch
              <select class="standard-select" name="{{key_code.id}}">
                <option>None</option>
              </select>
            </div>

            <div class="col">
              Scientific pitch
              <select class="scientific-select" name="{{key_code.id}}">
                <option>None</option>
              </select>
            </div>

          </div>
        {% endfor %}
       </div>
    </div>
    <p>
      <input class="btn btn-primary" type="submit" name="submit" value="Submit" />
    </p>
  </div>
</form>

<script type="text/javascript">
  window.notes2freqs = {
    'A0': 27.500,
    'A0#': 29.135,
    'B0b': 29.135,
    'B0': 30.868,
    'C1': 32.703,
    'C1#': 34.648,
    'D1b': 34.648,
    'D1': 36.708,
    'D1#': 38.891,
    'E1b': 38.891,
    'E1': 41.203,
    'F1': 43.654,
    'G1': 48.999,
    'G1#': 51.913,
    'A1b': 51.913,
    'A1': 55.000,
    'A1#': 58.270,
    'B1b': 58.270,
    'B1': 61.735,
    'C2': 65.406,
    'C2#': 69.296,
    'D2b': 69.296,
    'D2': 73.416,
    'D2#': 77.782,
    'E2b': 77.782,
    'E2': 82.407,
    'F2': 87.307,
    'F2#': 92.499,
    'G2b': 92.499,
    'G2': 97.999,
    'G2#': 103.83,
    'A2': 110.00,
    'A2#': 116.54,
    'B2b': 116.54,
    'B2': 123.47,
    'C3': 130.81,
    'C3#': 138.59,
    'D3b': 138.59,
    'D3': 146.83,
    'D3#': 155.56,
    'E3': 164.81,
    'F3': 174.61,
    'F3#': 185.00,
    'G3b': 185.00,
    'G3': 196.00,
    'G3#': 207.65,
    'A3b': 207.65,
    'A3': 220.00,
    'A3#': 233.08,
    'B3b': 233.08,
    'B3': 246.94,
    'C4': 261.63,
    'C4#': 277.18,
    'D4b': 277.18,
    'D4': 293.67,
    'D4#': 311.13,
    'E4b': 311.13,
    'E4': 329.63,
    'F4': 349.23,
    'F4#': 369.99,
    'G4b': 369.99,
    'G4': 392.00,
    'G4#': 415.30,
    'A4b': 415.30,
    'A4': 440.00,
    'A4#': 466.16,
    'B4b': 466.16,
    'B4': 493.88,
    'C5': 523.25,
    'C5#': 554.37,
    'D5b': 554.37,
    'D5': 587.33,
    'D5#': 622.25,
    'E5b': 622.25,
    'E5': 659.26,
    'F5': 698.46,
    'F5#': 739.99,
    'G5b': 739.99,
    'G5': 783.99,
    'G5#': 830.61,
    'A5b': 830.61,
    'A5': 880.00,
    'A5#': 932.33,
    'B5b': 932.33,
    'B5': 987.77,
    'C6': 1046.5,
    'C6#': 1108.7,
    'D6b': 1108.7,
    'D6': 1174.7,
    'D6#': 1244.5,
    'E6b': 1244.5,
    'E6': 1318.5,
    'F6': 1396.9,
    'F6#': 1480.0,
    'G6b': 1480.0,
    'G6': 1568.0,
    'G6#': 1661.2,
    'A6b': 1661.2,
    'A6': 1760.0,
    'A6#': 1864.7,
    'B6b': 1864.7,
    'B6': 1975.5,
    'C7': 2093.0,
    'C7#': 2217.5,
    'D7b': 2217.5,
    'D7': 2349.3,
    'D7#': 2489.0,
    'E7b': 2489.0,
    'E7': 2637.0,
    'F7': 2793.0,
    'F7#': 2960.0,
    'G7b': 2960.0,
    'G7': 3136.0,
    'G7#': 3322.4,
    'A7b': 3322.4,
    'A7': 3520.0,
    'A7#': 3729.3,
    'B7b': 3729.3,
    'B7': 3951.1,
    'C8': 4186.0
  }

  window.sciPitch = {
    C1: 128,
    D1: 144,
    E1: 162,
    F1: 176,
    G1: 192,
    A1: 216,
    B1: 243,
    C2: 256,
    D2: 288,
    E2: 324,
    F2: 352,
    G2: 384,
    A2: 432,
    B2: 486,
    C3: 512,
    D3: 576,
    E3: 648,
    F3: 704,
    G3: 768,
    A3: 864,
    B3: 972
  }

  var standardSelects = document.getElementsByClassName('standard-select')
  var scientificSelects = document.getElementsByClassName('scientific-select')

  for(var i = 0;  i < standardSelects.length; i++){
    standardSelects[i].addEventListener('change', (e) => {
      var keyCode = e.target.name
      var freq = e.target.value
      
      document.getElementById(keyCode).value = freq
    })

    Object.keys(window.notes2freqs).forEach((note) => {
      var newOption = document.createElement("option");
      newOption.text = note + ' - ' + window.notes2freqs[note] + 'hz'
      newOption.value = window.notes2freqs[note]
      standardSelects[i].append(newOption)
    })
  }

  for(var i = 0;  i < scientificSelects.length; i++){
    scientificSelects[i].addEventListener('change', (e) => {
      var keyCode = e.target.name
      var freq = e.target.value
      
      document.getElementById(keyCode).value = freq
    })

    Object.keys(window.sciPitch).forEach((note) => {
      var newOption = document.createElement("option");
      newOption.text = note + ' - ' + window.sciPitch[note] + 'hz'
      newOption.value = window.sciPitch[note]
      scientificSelects[i].append(newOption)
    })
  }

  

</script>
{% endblock %}